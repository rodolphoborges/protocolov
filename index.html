<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <title>Protocolo V | Recrutamento Valorant</title>
    <meta name="description" content="Recrutamento tático e focado para Valorant. Suba de elo e jogue Premiere em um ambiente sem toxicidade.">
    <meta name="theme-color" content="#ff4655">

    <link rel="icon" type="image/png" href="https://media.valorant-api.com/competitivetiers/03621f52-342b-cf4e-4f86-9350a49c6d04/24/smallicon.png">

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&family=Teko:wght@500;700&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --val-dark: #0f1923;
            --val-light: #ece8e1;
            --val-red: #ff4655;
            --val-gray: #768079;
        }

        body {
            background-color: var(--val-light);
            color: var(--val-dark);
            font-family: 'Inter', sans-serif;
            overflow-x: hidden;
            scroll-behavior: smooth;
        }

        h1, h2, h3, .role-title { font-family: 'Teko', sans-serif; text-transform: uppercase; line-height: 0.9; margin: 0; }

        .display-massive {
            font-size: clamp(4rem, 15vw, 12rem);
            color: var(--val-light);
            text-shadow: -1px -1px 0 var(--val-dark), 1px -1px 0 var(--val-dark), -1px 1px 0 var(--val-dark), 1px 1px 0 var(--val-dark);
            opacity: 0.1; position: absolute; top: -20px; left: -20px; z-index: 0; user-select: none;
        }

        .section-header {
            position: relative; z-index: 1; font-size: clamp(2.5rem, 6vw, 5rem);
            color: var(--val-dark); border-bottom: 2px solid var(--val-dark);
            padding-bottom: 10px; margin-bottom: 30px;
        }

        .text-accent { color: var(--val-red); }
        .bg-dark-section { background-color: var(--val-dark); color: var(--val-light); }

        .role-row { border-bottom: 1px solid rgba(15, 25, 35, 0.2); padding: 30px 0; transition: all 0.3s ease; }
        .role-title { font-size: 3rem; }
        .slot-indicator { font-family: 'Teko', sans-serif; font-size: 2.5rem; color: var(--val-red); }
        .role-full .slot-indicator { color: var(--val-gray); text-decoration: line-through; }

        /* Cards */
        .player-card {
            background-color: rgba(15, 25, 35, 0.4); border: 1px solid var(--val-gray);
            display: flex; align-items: center; gap: 15px; transition: 0.3s ease; height: 100%;
        }
        .player-card:hover { border-color: var(--val-red); background-color: rgba(15, 25, 35, 0.8); transform: translateY(-2px); }
        .player-avatar { width: 64px; height: 64px; object-fit: cover; border: 1px solid var(--val-red); }
        
        /* Fila de Espera */
        .waitlist-section { border-top: 1px dashed rgba(118, 128, 121, 0.4); margin-top: 20px; padding-top: 15px; }
        .waitlist-label { font-family: 'Teko', sans-serif; color: var(--val-gray); font-size: 1.5rem; text-transform: uppercase; letter-spacing: 1px; }
        .player-card.is-waiting { opacity: 0.65; border-style: dashed; background-color: rgba(15, 25, 35, 0.15); }
        .player-card.is-waiting:hover { opacity: 1; border-color: var(--val-gray); background-color: rgba(15, 25, 35, 0.6); transform: translateY(-2px); }
        .player-card.is-waiting .player-avatar { width: 48px; height: 48px; border-color: var(--val-gray); }

        .stat-label { font-size: 0.65rem; color: var(--val-gray); text-transform: uppercase; letter-spacing: 1px; }
        .stat-val { font-size: 0.9rem; color: var(--val-light); font-family: 'Inter', sans-serif; font-weight: 600; }

        .btn-val {
            display: inline-block; background-color: var(--val-red); color: var(--val-light); font-family: 'Teko', sans-serif;
            font-size: 2rem; padding: 10px 40px; text-decoration: none; text-transform: uppercase; position: relative;
            transition: 0.2s ease-in-out; border: 1px solid transparent; cursor: pointer;
        }
        .btn-val::before {
            content: ''; position: absolute; top: 0; left: 0; width: 10px; height: 10px;
            border-top: 2px solid var(--val-light); border-left: 2px solid var(--val-light);
        }
        .btn-val:hover { background-color: var(--val-dark); color: var(--val-light); border: 1px solid var(--val-red); }

        .manifesto-text { font-size: 1.1rem; line-height: 1.6; color: var(--val-gray); }
        .manifesto-text strong { color: var(--val-dark); }
        .bg-dark-section .manifesto-text strong { color: var(--val-light); }
        
        .fade-in-section { opacity: 0; transform: translateY(30px); transition: opacity 0.8s ease-out, transform 0.8s ease-out; will-change: opacity, visibility; }
        .fade-in-section.is-visible { opacity: 1; transform: translateY(0); }
        .req-box { background-color: rgba(15, 25, 35, 0.05); border-left: 4px solid var(--val-red); padding: 15px 20px; text-align: left; margin: 0 auto 30px auto; max-width: 500px; }
        .icon-svg { width: 20px; height: 20px; fill: var(--val-red); margin-right: 10px; flex-shrink: 0;}
        .rule-item { display: flex; align-items: start; margin-bottom: 15px; }
    </style>
</head>
<body>

    <header class="container-fluid py-5 position-relative overflow-hidden fade-in-section is-visible">
        <div class="display-massive">PROTOCOLO V</div>
        <div class="container position-relative z-1 pt-5">
            <h1 class="display-1 fw-bold">PROTOCOLO <span class="text-accent">V</span></h1>
            <p class="fs-5 text-uppercase fw-bold text-muted mt-2">//// Foco na Ranqueada: 18h - 23h</p>
        </div>
    </header>

    <section class="container mb-5 fade-in-section">
        <div class="row g-5">
            <div class="col-lg-6">
                <h2 class="section-header">O Manifesto</h2>
                <p class="manifesto-text">O Protocolo V nasceu da vontade de ter partidas de qualidade no fim do dia. Nosso objetivo principal é <strong>dominar a fila ranqueada</strong>, subir de elo com consistência e construir uma sinergia real.</p>
            </div>
            <div class="col-lg-6">
                <h2 class="section-header">Regras de Engajamento</h2>
                <div class="manifesto-text">
                    <div class="rule-item">
                        <svg class="icon-svg" viewBox="0 0 16 16"><path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"/><path d="M10.97 4.97a.235.235 0 0 0-.02.022L7.477 9.417 5.384 7.323a.75.75 0 0 0-1.06 1.06L6.97 11.03a.75.75 0 0 0 1.079-.02l3.992-4.99a.75.75 0 0 0-1.071-1.05z"/></svg>
                        <div><strong>Comunicação Limpa:</strong> Calls precisas. Morreu? Passa a info e deixa o time jogar.</div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <section class="container-fluid bg-dark-section py-5 my-5 position-relative overflow-hidden fade-in-section">
        <div class="display-massive" style="color: var(--val-dark); text-shadow: none; opacity: 0.5;">AGENTES</div>
        <div class="container position-relative z-1">
            <h2 class="section-header" style="border-color: var(--val-light); color: var(--val-light);">Status da Line-up</h2>
            <p class="mb-5 text-muted text-uppercase">Total de 2 Squads.</p>
            
            <div id="roles-container">
                <div class="text-center py-5">
                    <div class="spinner-border text-danger" role="status"></div>
                </div>
            </div>
        </div>
    </section>

    <section class="container text-center py-5 mb-5 fade-in-section">
        <h2 class="section-header border-0 justify-content-center d-flex">Pronto para a rankeada?</h2>
        <a href="https://forms.gle/jULFiyjojXUiN3EcA" target="_blank" class="btn-val">Iniciar Inscrição</a>
    </section>

    <script>
        // Configuração das funções
        const rolesConfig = {
            'Sentinela': { max: 2, current: 0, desc: 'Setup defensivo e controle de flanco.', players: [], waitlist: [] },
            'Iniciador': { max: 2, current: 0, desc: 'Coleta de informação e quebra de bomb.', players: [], waitlist: [] },
            'Flex': { max: 2, current: 0, desc: 'Adaptação total às necessidades da composição.', players: [], waitlist: [] },
            'Duelista': { max: 2, current: 0, desc: 'Criação de espaço e entry agressivo.', players: [], waitlist: [] },
            'Controlador': { max: 2, current: 0, desc: 'Smokes, ritmo e domínio de mapa.', players: [], waitlist: [] } 
        };

        // Vai buscar os dados já processados pelo GitHub Actions
        async function fetchCachedData() {
            try {
                // Adiciona um timestamp para evitar o cache rígido do navegador
                const response = await fetch('data.json?t=' + Date.now());
                if (!response.ok) throw new Error('Ficheiro data.json não encontrado ou erro de rede.');
                
                const playersData = await response.json();
                
                playersData.forEach(player => {
                    let roleRaw = player.roleRaw.toLowerCase();
                    
                    for (let role in rolesConfig) {
                        const searchTerms = role === 'Controlador' ? ['controlador', 'smoker'] : [role.toLowerCase()];
                        if (searchTerms.some(term => roleRaw.includes(term))) {
                            // Lógica de distribuição: Titular ou Reserva
                            if (rolesConfig[role].current < rolesConfig[role].max) {
                                rolesConfig[role].current++;
                                rolesConfig[role].players.push(player);
                            } else if (rolesConfig[role].waitlist.length < 4) {
                                rolesConfig[role].waitlist.push(player);
                            }
                            break;
                        }
                    }
                });
                
                renderRoles();
            } catch (error) {
                console.error('Falha ao obter os dados cacheados:', error);
                document.getElementById('roles-container').innerHTML = `
                    <div class="alert alert-danger border-danger bg-transparent text-danger text-center">
                        Os dados táticos ainda estão a ser processados pelo sistema (GitHub Actions). Volte em alguns minutos.
                    </div>`;
            }
        }

        function createPlayerCardHTML(player, isWaiting = false) {
            const isWaitingClass = isWaiting ? 'is-waiting p-2' : 'p-2';
            
            // Tratamento caso a API tenha falhado lá no backend
            if (player.apiError) {
                return `
                    <div class="col-md-6">
                        <div class="player-card ${isWaitingClass} border-warning">
                            <span class="text-warning small">API Indisponível para ${player.riotId}</span>
                        </div>
                    </div>`;
            }

            const eloHTML = player.currentRankIcon 
                ? `<img src="${player.currentRankIcon}" alt="${player.currentRank}" style="width: 20px; height: 20px; object-fit: contain;"> ${player.currentRank}`
                : player.currentRank;

            const peakHTML = player.peakRankIcon
                ? `<img src="${player.peakRankIcon}" alt="${player.peakRank}" style="width: 20px; height: 20px; object-fit: contain;"> ${player.peakRank}`
                : player.peakRank;

            return `
                <div class="col-md-6">
                    <div class="player-card ${isWaitingClass}">
                        <img src="${player.card}" alt="Card" class="player-avatar">
                        <div class="flex-grow-1">
                            <div class="fw-bold text-white mb-2" style="font-size: 1rem; line-height: 1;">
                                ${player.riotId} <span class="badge bg-secondary ms-1" style="font-size: 0.6rem;">LVL ${player.level}</span>
                            </div>
                            <div class="d-flex gap-4">
                                <div>
                                    <div class="stat-label">Elo Atual</div>
                                    <div class="stat-val d-flex align-items-center gap-2">${eloHTML}</div>
                                </div>
                                <div>
                                    <div class="stat-label">Rank Máximo</div>
                                    <div class="stat-val text-accent d-flex align-items-center gap-2">${peakHTML}</div>
                                </div>
                            </div>
                        </div>
                        <div class="ms-auto pe-2">
                            <a href="${player.trackerLink}" target="_blank" class="btn btn-sm btn-outline-secondary" title="Tracker.gg" style="border-radius: 0;">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                                  <path fill-rule="evenodd" d="M8.636 3.5a.5.5 0 0 0-.5-.5H1.5A1.5 1.5 0 0 0 0 4.5v10A1.5 1.5 0 0 0 1.5 16h10a1.5 1.5 0 0 0 1.5-1.5V7.864a.5.5 0 0 0-1 0V14.5a.5.5 0 0 1-.5.5h-10a.5.5 0 0 1-.5-.5v-10a.5.5 0 0 1 .5-.5h6.636a.5.5 0 0 0 .5-.5"/>
                                  <path fill-rule="evenodd" d="M16 .5a.5.5 0 0 0-.5-.5h-5a.5.5 0 0 0 0 1h3.793L6.146 9.146a.5.5 0 1 0 .708.708L15 1.707V5.5a.5.5 0 0 0 1 0z"/>
                                </svg>
                            </a>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderRoles() {
            const container = document.getElementById('roles-container');
            let fullHTML = '';

            for (const [role, data] of Object.entries(rolesConfig)) {
                const isFull = data.current >= data.max;
                const formattedCurrent = String(data.current).padStart(2, '0');
                const formattedMax = String(data.max).padStart(2, '0');

                // Monta os Titulares
                let playersHTML = data.players.map(p => createPlayerCardHTML(p, false)).join('');

                // Monta a Fila de Reserva
                let waitlistHTML = '';
                if (data.waitlist.length > 0) {
                    let waitlistCardsHTML = data.waitlist.map(p => createPlayerCardHTML(p, true)).join('');
                    waitlistHTML = `
                        <div class="waitlist-section">
                            <div class="d-flex justify-content-between align-items-center mb-3">
                                <span class="waitlist-label">Fila de Reserva</span>
                                <span class="badge bg-secondary">${data.waitlist.length} na escuta</span>
                            </div>
                            <div class="row g-2">
                                ${waitlistCardsHTML}
                            </div>
                        </div>
                    `;
                }

                fullHTML += `
                    <div class="row align-items-start role-row ${isFull ? 'role-full' : ''}">
                        <div class="col-md-3 mb-4 mb-md-0">
                            <h3 class="role-title">${role}</h3>
                            <p class="mb-0 text-muted small">${data.desc}</p>
                        </div>
                        <div class="col-md-9">
                            <div class="d-flex justify-content-between align-items-center border-bottom border-secondary pb-2 mb-3">
                                <span class="text-uppercase text-muted small">Operadores Alocados</span>
                                <span class="slot-indicator fs-4 ${isFull ? 'text-secondary' : ''}">
                                    ${isFull ? 'FECHADO' : `[ ${formattedCurrent} / ${formattedMax} ]`}
                                </span>
                            </div>
                            <div class="row g-3">
                                ${playersHTML}
                            </div>
                            ${waitlistHTML}
                        </div>
                    </div>
                `;
            }
            container.innerHTML = fullHTML;
        }

        // Animações de Scroll
        const observerOptions = { root: null, rootMargin: '0px', threshold: 0.15 };
        const observer = new IntersectionObserver((entries, observer) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    entry.target.classList.add('is-visible');
                    observer.unobserve(entry.target);
                }
            });
        }, observerOptions);

        document.addEventListener('DOMContentLoaded', () => {
            fetchCachedData(); 
            const sections = document.querySelectorAll('.fade-in-section');
            sections.forEach(section => observer.observe(section));
        });
    </script>
</body>
</html>
